{
    "error_id": "117",
    "information": {
        "errors": [
            {
                "line": "441",
                "severity": "error",
                "message": "Line is longer than 150 characters (found 155).",
                "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
            }
        ]
    },
    "source_code": "        PagedResult<T> vlvResponse = new PagedResult<T>();\n        try {\n            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n                    start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n        } catch (Exception ex) {\n            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);",
    "results": [
        {
            "tool": "styler",
            "errors": [
                {
                    "line": "440",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 156).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "440",
                    "column": "13",
                    "severity": "error",
                    "message": "'{' at column 13 should have line break after.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.blocks.LeftCurlyCheck"
                },
                {
                    "line": "440",
                    "column": "13",
                    "severity": "error",
                    "message": "'{' is not followed by whitespace.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.whitespace.WhitespaceAroundCheck"
                }
            ],
            "diff": "diff --git a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/styler/117/LdapEntryManager.java\nindex f32c25786c..bf01505b06 100644\n--- a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java\n+++ b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/styler/117/LdapEntryManager.java\n@@ -437,368 +437,367 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         List<SearchResultEntry> searchResultEntries;\n         PagedResult<T> vlvResponse = new PagedResult<T>();\n-        try {\n-            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n-\n-        List<T> entries = new ArrayList<T>(0);\n-        if (searchResultEntries.size() > 0) {\n-            entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n-        }\n-        vlvResponse.setEntries(entries);\n-\n-        return vlvResponse;\n+        try {searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+                start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+    }\n \n+    List<T> entries = new ArrayList<T>(0);\n+    if (searchResultEntries.size() > 0) {\n+        entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n     }\n+    vlvResponse.setEntries(entries);\n \n-    @Deprecated\n-    public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n-            SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n+    return vlvResponse;\n \n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to find entries is null\");\n-        }\n+}\n \n-        // Check entry class\n-        checkEntryClass(entryClass, false);\n-        String[] objectClasses = getTypeObjectClasses(entryClass);\n-        List<PropertyAnnotation> propertiesAnnotations = getEntryPropertyAnnotations(entryClass);\n-        String[] currentLdapReturnAttributes = ldapReturnAttributes;\n-        if (ArrayHelper.isEmpty(currentLdapReturnAttributes)) {\n-            currentLdapReturnAttributes = getLdapAttributes(null, propertiesAnnotations, false);\n-        }\n+@Deprecated\n+public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n+        SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n \n-        // Find entries\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to find entries is null\");\n+    }\n \n-        SearchResult searchResult = null;\n-        try {\n+    // Check entry class\n+    checkEntryClass(entryClass, false);\n+    String[] objectClasses = getTypeObjectClasses(entryClass);\n+    List<PropertyAnnotation> propertiesAnnotations = getEntryPropertyAnnotations(entryClass);\n+    String[] currentLdapReturnAttributes = ldapReturnAttributes;\n+    if (ArrayHelper.isEmpty(currentLdapReturnAttributes)) {\n+        currentLdapReturnAttributes = getLdapAttributes(null, propertiesAnnotations, false);\n+    }\n \n-            searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+    // Find entries\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n+    }\n \n-            if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n-            }\n+    SearchResult searchResult = null;\n+    try {\n \n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n+        searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+                start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n \n-        if (searchResult.getEntryCount() == 0) {\n-            return new ArrayList<T>(0);\n+        if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n         }\n \n-        List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+    }\n \n-        return entries;\n+    if (searchResult.getEntryCount() == 0) {\n+        return new ArrayList<T>(0);\n     }\n \n-    @Override\n-    protected boolean contains(String baseDN, Filter filter, String[] objectClasses, String[] ldapReturnAttributes) {\n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to check contain entries is null\");\n-        }\n+    List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n+            searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n-        // Create filter\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    return entries;\n+}\n \n-        SearchResult searchResult = null;\n-        try {\n-            searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n-            if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n-            }\n-        } catch (SearchException ex) {\n-            if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-            }\n-        }\n+@Override\n+protected boolean contains(String baseDN, Filter filter, String[] objectClasses, String[] ldapReturnAttributes) {\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to check contain entries is null\");\n+    }\n \n-        return (searchResult != null) && (searchResult.getEntryCount() > 0);\n+    // Create filter\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n     }\n \n-    protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n-        List<T> result = new ArrayList<T>(searchResultEntries.length);\n-        Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n+    SearchResult searchResult = null;\n+    try {\n+        searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n+        if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n+        }\n+    } catch (SearchException ex) {\n+        if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+        }\n+    }\n \n-        int count = 0;\n-        for (int i = 0; i < searchResultEntries.length; i++) {\n-            count++;\n-            SearchResultEntry entry = searchResultEntries[i];\n-            entriesAttributes.put(entry.getDN(), getAttributeDataList(entry));\n+    return (searchResult != null) && (searchResult.getEntryCount() > 0);\n+}\n \n-            // Remove reference to allow java clean up object\n-            searchResultEntries[i] = null;\n+protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n+        SearchResultEntry... searchResultEntries) {\n+    List<T> result = new ArrayList<T>(searchResultEntries.length);\n+    Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n \n-            // Allow java to clean up temporary objects\n-            if (count >= 100) {\n-                List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n-                result.addAll(currentResult);\n+    int count = 0;\n+    for (int i = 0; i < searchResultEntries.length; i++) {\n+        count++;\n+        SearchResultEntry entry = searchResultEntries[i];\n+        entriesAttributes.put(entry.getDN(), getAttributeDataList(entry));\n \n-                entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n-                count = 0;\n-            }\n-        }\n+        // Remove reference to allow java clean up object\n+        searchResultEntries[i] = null;\n \n-        List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n-        result.addAll(currentResult);\n+        // Allow java to clean up temporary objects\n+        if (count >= 100) {\n+            List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n+            result.addAll(currentResult);\n \n-        return result;\n+            entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n+            count = 0;\n+        }\n     }\n \n-    @Deprecated\n-    private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n+    List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n+    result.addAll(currentResult);\n \n-        List<T> result = new LinkedList<T>();\n-        Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n+    return result;\n+}\n \n-        int count = 0;\n-        for (int i = 0; i < searchResultEntries.length; i++) {\n+@Deprecated\n+private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n+        SearchResultEntry... searchResultEntries) {\n \n-            count++;\n+    List<T> result = new LinkedList<T>();\n+    Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n \n-            SearchResultEntry entry = searchResultEntries[i];\n+    int count = 0;\n+    for (int i = 0; i < searchResultEntries.length; i++) {\n \n-            LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n-            attributeDataLinkedList.addAll(getAttributeDataList(entry));\n-            entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n+        count++;\n \n-            // Remove reference to allow java clean up object\n-            searchResultEntries[i] = null;\n+        SearchResultEntry entry = searchResultEntries[i];\n \n-            // Allow java to clean up temporary objects\n-            if (count >= 100) {\n+        LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n+        attributeDataLinkedList.addAll(getAttributeDataList(entry));\n+        entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n \n-                List<T> currentResult = new LinkedList<T>();\n-                currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n-                result.addAll(currentResult);\n+        // Remove reference to allow java clean up object\n+        searchResultEntries[i] = null;\n \n-                entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n-                count = 0;\n-            }\n-        }\n+        // Allow java to clean up temporary objects\n+        if (count >= 100) {\n \n-        List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n-        result.addAll(currentResult);\n+            List<T> currentResult = new LinkedList<T>();\n+            currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n+            result.addAll(currentResult);\n \n-        return result;\n+            entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n+            count = 0;\n+        }\n     }\n \n-    private List<AttributeData> getAttributeDataList(SearchResultEntry entry) {\n-        if (entry == null) {\n-            return null;\n-        }\n+    List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n+    result.addAll(currentResult);\n \n-        List<AttributeData> result = new ArrayList<AttributeData>();\n-        for (Attribute attribute : entry.getAttributes()) {\n-            String[] attributeValueStrings = NO_STRINGS;\n-            String attributeName = attribute.getName();\n-            if (LOG.isTraceEnabled()) {\n-                if (attribute.needsBase64Encoding()) {\n-                    LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n-                            + operationService.isBinaryAttribute(attributeName));\n-                }\n-            }\n+    return result;\n+}\n \n-            attributeValueStrings = attribute.getValues();\n+private List<AttributeData> getAttributeDataList(SearchResultEntry entry) {\n+    if (entry == null) {\n+        return null;\n+    }\n+\n+    List<AttributeData> result = new ArrayList<AttributeData>();\n+    for (Attribute attribute : entry.getAttributes()) {\n+        String[] attributeValueStrings = NO_STRINGS;\n+        String attributeName = attribute.getName();\n+        if (LOG.isTraceEnabled()) {\n             if (attribute.needsBase64Encoding()) {\n-                boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n-                boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n-\n-                if (binaryAttribute || certificateAttribute) {\n-                    byte[][] attributeValues = attribute.getValueByteArrays();\n-                    if (attributeValues != null) {\n-                        attributeValueStrings = new String[attributeValues.length];\n-                        for (int i = 0; i < attributeValues.length; i++) {\n-                            attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n-                            LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n-                                    + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n-                                    + attributeValueStrings[i]);\n-                        }\n+                LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n+                        + operationService.isBinaryAttribute(attributeName));\n+            }\n+        }\n+\n+        attributeValueStrings = attribute.getValues();\n+        if (attribute.needsBase64Encoding()) {\n+            boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n+            boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n+\n+            if (binaryAttribute || certificateAttribute) {\n+                byte[][] attributeValues = attribute.getValueByteArrays();\n+                if (attributeValues != null) {\n+                    attributeValueStrings = new String[attributeValues.length];\n+                    for (int i = 0; i < attributeValues.length; i++) {\n+                        attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n+                        LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n+                                + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n+                                + attributeValueStrings[i]);\n                     }\n                 }\n-                if (certificateAttribute) {\n-                    attributeName = operationService.getCertificateAttributeName(attributeName);\n-                }\n             }\n-\n-            AttributeData tmpAttribute = new AttributeData(attributeName, attributeValueStrings);\n-            result.add(tmpAttribute);\n+            if (certificateAttribute) {\n+                attributeName = operationService.getCertificateAttributeName(attributeName);\n+            }\n         }\n \n-        return result;\n+        AttributeData tmpAttribute = new AttributeData(attributeName, attributeValueStrings);\n+        result.add(tmpAttribute);\n     }\n \n-    @Override\n-    public boolean authenticate(String baseDN, String userName, String password) {\n-        try {\n-            Filter filter = Filter.createEqualityFilter(LdapOperationsServiceImpl.UID, userName);\n-            SearchResult searchResult = operationService.search(baseDN, toLdapFilter(filter), 1, 1);\n-            if ((searchResult == null) || (searchResult.getEntryCount() != 1)) {\n-                return false;\n-            }\n-\n-            String bindDn = searchResult.getSearchEntries().get(0).getDN();\n+    return result;\n+}\n \n-            return operationService.authenticate(bindDn, password);\n-        } catch (ConnectionException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to authenticate user: %s\", userName), ex);\n-        } catch (SearchException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to find user DN: %s\", userName), ex);\n+@Override\n+public boolean authenticate(String baseDN, String userName, String password) {\n+    try {\n+        Filter filter = Filter.createEqualityFilter(LdapOperationsServiceImpl.UID, userName);\n+        SearchResult searchResult = operationService.search(baseDN, toLdapFilter(filter), 1, 1);\n+        if ((searchResult == null) || (searchResult.getEntryCount() != 1)) {\n+            return false;\n         }\n-    }\n \n-    @Override\n-    public boolean authenticate(String bindDn, String password) {\n-        try {\n-            return operationService.authenticate(bindDn, password);\n-        } catch (ConnectionException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to authenticate DN: %s\", bindDn), ex);\n-        }\n+        String bindDn = searchResult.getSearchEntries().get(0).getDN();\n+\n+        return operationService.authenticate(bindDn, password);\n+    } catch (ConnectionException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to authenticate user: %s\", userName), ex);\n+    } catch (SearchException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to find user DN: %s\", userName), ex);\n     }\n+}\n \n-    @Override\n-    public <T> int countEntries(String baseDN, Class<T> entryClass, Filter filter) {\n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to find entries is null\");\n-        }\n+@Override\n+public boolean authenticate(String bindDn, String password) {\n+    try {\n+        return operationService.authenticate(bindDn, password);\n+    } catch (ConnectionException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to authenticate DN: %s\", bindDn), ex);\n+    }\n+}\n \n-        // Check entry class\n-        checkEntryClass(entryClass, false);\n-        String[] objectClasses = getTypeObjectClasses(entryClass);\n-        String[] ldapReturnAttributes = new String[] {\"\"}; // Don't load attributes\n+@Override\n+public <T> int countEntries(String baseDN, Class<T> entryClass, Filter filter) {\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to find entries is null\");\n+    }\n \n-        // Find entries\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    // Check entry class\n+    checkEntryClass(entryClass, false);\n+    String[] objectClasses = getTypeObjectClasses(entryClass);\n+    String[] ldapReturnAttributes = new String[] {\"\"}; // Don't load attributes\n \n-        CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n+    // Find entries\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n+    }\n \n-        try {\n-            LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n-            operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n-                    ldapReturnAttributes);\n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(\n-                    String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n+    CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n \n-        return batchOperation.getCountEntries();\n+    try {\n+        LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n+        operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n+                ldapReturnAttributes);\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(\n+                String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n     }\n \n-    @Override\n-    public String encodeTime(Date date) {\n-        if (date == null) {\n-            return null;\n-        }\n+    return batchOperation.getCountEntries();\n+}\n \n-        return StaticUtils.encodeGeneralizedTime(date);\n+@Override\n+public String encodeTime(Date date) {\n+    if (date == null) {\n+        return null;\n     }\n \n-    public Date decodeTime(String date) {\n-        if (date == null) {\n-            return null;\n-        }\n-\n-        try {\n-            return StaticUtils.decodeGeneralizedTime(date);\n-        } catch (ParseException ex) {\n-            LOG.error(\"Failed to parse generalized time {}\", date, ex);\n-        }\n+    return StaticUtils.encodeGeneralizedTime(date);\n+}\n \n+public Date decodeTime(String date) {\n+    if (date == null) {\n         return null;\n     }\n \n-    public boolean loadLdifFileContent(String ldifFileContent) {\n-        LDAPConnection connection = null;\n-        try {\n-            connection = operationService.getConnection();\n-            ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n-            return ResultCode.SUCCESS.equals(result);\n-        } catch (Exception ex) {\n-            LOG.error(\"Failed to load ldif file\", ex);\n-            return false;\n-        } finally {\n-            if (connection != null) {\n-                operationService.releaseConnection(connection);\n-            }\n-        }\n+    try {\n+        return StaticUtils.decodeGeneralizedTime(date);\n+    } catch (ParseException ex) {\n+        LOG.error(\"Failed to parse generalized time {}\", date, ex);\n     }\n \n-    @Override\n-    public String[] exportEntry(String dn) {\n-        String[] ldif = null;\n-        try {\n-            ldif = this.operationService.lookup(dn).toLDIF();\n-        } catch (ConnectionException e) {\n-            LOG.error(\"Failed get ldif from \" + dn, e);\n-        }\n+    return null;\n+}\n \n-        return ldif;\n+public boolean loadLdifFileContent(String ldifFileContent) {\n+    LDAPConnection connection = null;\n+    try {\n+        connection = operationService.getConnection();\n+        ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n+        return ResultCode.SUCCESS.equals(result);\n+    } catch (Exception ex) {\n+        LOG.error(\"Failed to load ldif file\", ex);\n+        return false;\n+    } finally {\n+        if (connection != null) {\n+            operationService.releaseConnection(connection);\n+        }\n     }\n+}\n \n-    public int getSupportedLDAPVersion() {\n-        return this.operationService.getSupportedLDAPVersion();\n+@Override\n+public String[] exportEntry(String dn) {\n+    String[] ldif = null;\n+    try {\n+        ldif = this.operationService.lookup(dn).toLDIF();\n+    } catch (ConnectionException e) {\n+        LOG.error(\"Failed get ldif from \" + dn, e);\n     }\n \n-    private Modification createModification(final ModificationType modificationType, final String attributeName, final String... attributeValues) {\n-        String realAttributeName = attributeName;\n-        if (operationService.isCertificateAttribute(realAttributeName)) {\n-            realAttributeName += \";binary\";\n-            byte[][] binaryValues = toBinaryValues(attributeValues);\n+    return ldif;\n+}\n \n-            return new Modification(modificationType, realAttributeName, binaryValues);\n-        }\n+public int getSupportedLDAPVersion() {\n+    return this.operationService.getSupportedLDAPVersion();\n+}\n \n-        return new Modification(modificationType, realAttributeName, attributeValues);\n-    }\n+private Modification createModification(final ModificationType modificationType, final String attributeName, final String... attributeValues) {\n+    String realAttributeName = attributeName;\n+    if (operationService.isCertificateAttribute(realAttributeName)) {\n+        realAttributeName += \";binary\";\n+        byte[][] binaryValues = toBinaryValues(attributeValues);\n \n-    private com.unboundid.ldap.sdk.Filter toLdapFilter(Filter genericFilter) throws SearchException {\n-        return LDAP_FILTER_CONVERTER.convertToLdapFilter(genericFilter);\n+        return new Modification(modificationType, realAttributeName, binaryValues);\n     }\n \n-    private com.unboundid.ldap.sdk.SearchScope toLdapSearchScope(SearchScope scope) throws SearchScopeException {\n-        return LDAP_SEARCH_SCOPE_CONVERTER.convertToLdapSearchScope(scope);\n-    }\n+    return new Modification(modificationType, realAttributeName, attributeValues);\n+}\n \n-    private static final class CountBatchOperation<T> extends DefaultBatchOperation<T> {\n+private com.unboundid.ldap.sdk.Filter toLdapFilter(Filter genericFilter) throws SearchException {\n+    return LDAP_FILTER_CONVERTER.convertToLdapFilter(genericFilter);\n+}\n \n-        private int countEntries = 0;\n+private com.unboundid.ldap.sdk.SearchScope toLdapSearchScope(SearchScope scope) throws SearchScopeException {\n+    return LDAP_SEARCH_SCOPE_CONVERTER.convertToLdapSearchScope(scope);\n+}\n \n-        @Override\n-        public void performAction(List<T> entries) {\n-        }\n+private static final class CountBatchOperation<T> extends DefaultBatchOperation<T> {\n \n-        @Override\n-        public boolean collectSearchResult(int size) {\n-            countEntries += size;\n-            return false;\n-        }\n+    private int countEntries = 0;\n \n-        public int getCountEntries() {\n-            return countEntries;\n-        }\n+    @Override\n+    public void performAction(List<T> entries) {\n+    }\n+\n+    @Override\n+    public boolean collectSearchResult(int size) {\n+        countEntries += size;\n+        return false;\n     }\n \n+    public int getCountEntries() {\n+        return countEntries;\n+    }\n+}\n+\n }\n",
            "diff_size": 393
        },
        {
            "tool": "intellij",
            "errors": [],
            "diff": "diff --git a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/intellij/117/LdapEntryManager.java\nindex f32c25786c..1a23571dcc 100644\n--- a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java\n+++ b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/intellij/117/LdapEntryManager.java\n@@ -118,7 +118,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n     @Override\n     protected <T> void updateMergeChanges(T entry, boolean isSchemaUpdate, Class<?> entryClass, Map<String, AttributeData> attributesFromLdapMap,\n-            List<AttributeDataModification> attributeDataModifications) {\n+                                          List<AttributeDataModification> attributeDataModifications) {\n         // Update object classes if entry contains custom object classes\n         if (getSupportedLDAPVersion() > 2) {\n             if (!isSchemaUpdate) {\n@@ -127,7 +127,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n                 if (!Arrays.equals(objectClassesFromLdap, objectClasses)) {\n                     attributeDataModifications.add(new AttributeDataModification(AttributeModificationType.REPLACE,\n-                            new AttributeData(OBJECT_CLASS, objectClasses), new AttributeData(OBJECT_CLASS, objectClassesFromLdap)));\n+                        new AttributeData(OBJECT_CLASS, objectClasses), new AttributeData(OBJECT_CLASS, objectClassesFromLdap)));\n                 }\n             }\n         }\n@@ -256,13 +256,13 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n                             if (removeValues.size() > 0) {\n                                 Modification removeModification = createModification(ModificationType.DELETE, attributeName,\n-                                        removeValues.toArray(new String[removeValues.size()]));\n+                                    removeValues.toArray(new String[removeValues.size()]));\n                                 modifications.add(removeModification);\n                             }\n \n                             if (addValues.size() > 0) {\n                                 Modification addModification = createModification(ModificationType.ADD, attributeName,\n-                                        addValues.toArray(new String[addValues.size()]));\n+                                    addValues.toArray(new String[addValues.size()]));\n                                 modifications.add(addModification);\n                             }\n                         }\n@@ -363,7 +363,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n     @Override\n     public <T> List<T> findEntries(String baseDN, Class<T> entryClass, Filter filter, SearchScope scope, String[] ldapReturnAttributes,\n-            BatchOperation<T> batchOperation, int start, int count, int chunkSize) {\n+                                   BatchOperation<T> batchOperation, int start, int count, int chunkSize) {\n         if (StringHelper.isEmptyString(baseDN)) {\n             throw new MappingException(\"Base DN to find entries is null\");\n         }\n@@ -387,9 +387,9 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         SearchResult searchResult = null;\n         try {\n             LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation, this, entryClass,\n-                    propertiesAnnotations);\n+                propertiesAnnotations);\n             searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(scope), batchOperationWraper,\n-                    start, chunkSize, count, null, currentLdapReturnAttributes);\n+                start, chunkSize, count, null, currentLdapReturnAttributes);\n \n             if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n                 throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n@@ -403,7 +403,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         List<T> entries = createEntities(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+            searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n         // Default sort if needed\n         sortEntriesIfNeeded(entryClass, entries);\n@@ -413,7 +413,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n     @Override\n     public <T> PagedResult<T> findPagedEntries(String baseDN, Class<T> entryClass, Filter filter, String[] ldapReturnAttributes, String sortBy,\n-            SortOrder sortOrder, int start, int count, int chunkSize) {\n+                                               SortOrder sortOrder, int start, int count, int chunkSize) {\n         if (StringHelper.isEmptyString(baseDN)) {\n             throw new MappingException(\"Base DN to find entries is null\");\n         }\n@@ -438,7 +438,8 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         List<SearchResultEntry> searchResultEntries;\n         PagedResult<T> vlvResponse = new PagedResult<T>();\n         try {\n-            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+            searchResultEntries =\n+                this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n                     start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n         } catch (Exception ex) {\n             throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n@@ -446,7 +447,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         List<T> entries = new ArrayList<T>(0);\n         if (searchResultEntries.size() > 0) {\n-            entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n+            entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[] {}));\n         }\n         vlvResponse.setEntries(entries);\n \n@@ -456,7 +457,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n     @Deprecated\n     public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n-            SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n+                                                  SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n \n         if (StringHelper.isEmptyString(baseDN)) {\n             throw new MappingException(\"Base DN to find entries is null\");\n@@ -483,7 +484,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         try {\n \n             searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+                start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n \n             if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n                 throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n@@ -498,7 +499,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+            searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n         return entries;\n     }\n@@ -533,7 +534,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n     }\n \n     protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n+                                         SearchResultEntry... searchResultEntries) {\n         List<T> result = new ArrayList<T>(searchResultEntries.length);\n         Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n \n@@ -564,7 +565,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n     @Deprecated\n     private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n+                                                      SearchResultEntry... searchResultEntries) {\n \n         List<T> result = new LinkedList<T>();\n         Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n@@ -613,7 +614,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n             if (LOG.isTraceEnabled()) {\n                 if (attribute.needsBase64Encoding()) {\n                     LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n-                            + operationService.isBinaryAttribute(attributeName));\n+                        + operationService.isBinaryAttribute(attributeName));\n                 }\n             }\n \n@@ -629,8 +630,8 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n                         for (int i = 0; i < attributeValues.length; i++) {\n                             attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n                             LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n-                                    + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n-                                    + attributeValueStrings[i]);\n+                                + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n+                                + attributeValueStrings[i]);\n                         }\n                     }\n                 }\n@@ -698,10 +699,10 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         try {\n             LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n             operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n-                    ldapReturnAttributes);\n+                ldapReturnAttributes);\n         } catch (Exception ex) {\n             throw new EntryPersistenceException(\n-                    String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+                String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n         }\n \n         return batchOperation.getCountEntries();\n",
            "diff_size": 22
        },
        {
            "tool": "naturalize",
            "errors": [
                {
                    "line": "441",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 155).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                }
            ],
            "diff": "diff --git a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/naturalize/117/LdapEntryManager.java\nindex f32c25786c..585eded11c 100644\n--- a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java\n+++ b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/naturalize/117/LdapEntryManager.java\n@@ -481,8 +481,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         SearchResult searchResult = null;\n         try {\n-\n-            searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+    searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n                     start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n \n             if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n@@ -801,4 +800,4 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n     }\n \n-}\n+}\n\\ No newline at end of file\n",
            "diff_size": 3
        },
        {
            "tool": "codebuff",
            "errors": [
                {
                    "line": "117",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 207).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "124",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 221).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "257",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 168).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "358",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 208).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "383",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 152).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "384",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 200).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "398",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 180).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "406",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 203).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "432",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 242).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "449",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 216).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "474",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 218).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "488",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 195).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "525",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 153).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "553",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 166).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "594",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 160).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "608",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 224).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "675",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 169).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                }
            ],
            "diff": "diff --git a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/codebuff/117/LdapEntryManager.java\nindex f32c25786c..ef142d5826 100644\n--- a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java\n+++ b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/codebuff/117/LdapEntryManager.java\n@@ -18,7 +18,6 @@ import java.util.LinkedHashMap;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.Map;\n-\n import org.apache.commons.codec.binary.Base64;\n import org.gluu.persist.event.DeleteNotifier;\n import org.gluu.persist.exception.AuthenticationException;\n@@ -43,7 +42,6 @@ import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.xdi.util.ArrayHelper;\n import org.xdi.util.StringHelper;\n-\n import com.unboundid.ldap.sdk.Attribute;\n import com.unboundid.ldap.sdk.LDAPConnection;\n import com.unboundid.ldap.sdk.Modification;\n@@ -58,20 +56,18 @@ import com.unboundid.util.StaticUtils;\n  *\n  * @author Yuriy Movchan Date: 10.07.2010\n  */\n+\n+\n public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n     private static final long serialVersionUID = -2544614410981223105L;\n-\n     private static final Logger LOG = LoggerFactory.getLogger(LdapEntryManager.class);\n-\n     private static final LdapFilterConverter LDAP_FILTER_CONVERTER = new LdapFilterConverter();\n     private static final LdapSearchScopeConverter LDAP_SEARCH_SCOPE_CONVERTER = new LdapSearchScopeConverter();\n-\n     private LdapOperationsServiceImpl operationService;\n     private List<DeleteNotifier> subscribers;\n \n-    public LdapEntryManager() {\n-    }\n+    public LdapEntryManager() { }\n \n     public LdapEntryManager(LdapOperationsServiceImpl operationService) {\n         this.operationService = operationService;\n@@ -105,6 +101,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n     public <T> T merge(T entry) {\n         Class<?> entryClass = entry.getClass();\n         checkEntryClass(entryClass, true);\n+\n         if (isLdapSchemaEntry(entryClass)) {\n             if (getSupportedLDAPVersion() > 2) {\n                 return merge(entry, true, AttributeModificationType.ADD);\n@@ -117,17 +114,14 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n     }\n \n     @Override\n-    protected <T> void updateMergeChanges(T entry, boolean isSchemaUpdate, Class<?> entryClass, Map<String, AttributeData> attributesFromLdapMap,\n-            List<AttributeDataModification> attributeDataModifications) {\n+    protected <T> void updateMergeChanges(T entry, boolean isSchemaUpdate, Class<?> entryClass, Map<String, AttributeData> attributesFromLdapMap, List<AttributeDataModification> attributeDataModifications) {\n         // Update object classes if entry contains custom object classes\n         if (getSupportedLDAPVersion() > 2) {\n             if (!isSchemaUpdate) {\n                 String[] objectClasses = getObjectClasses(entry, entryClass);\n                 String[] objectClassesFromLdap = attributesFromLdapMap.get(OBJECT_CLASS.toLowerCase()).getValues();\n-\n                 if (!Arrays.equals(objectClassesFromLdap, objectClasses)) {\n-                    attributeDataModifications.add(new AttributeDataModification(AttributeModificationType.REPLACE,\n-                            new AttributeData(OBJECT_CLASS, objectClasses), new AttributeData(OBJECT_CLASS, objectClassesFromLdap)));\n+                    attributeDataModifications.add(new AttributeDataModification(AttributeModificationType.REPLACE, new AttributeData(OBJECT_CLASS, objectClasses), new AttributeData(OBJECT_CLASS, objectClassesFromLdap)));\n                 }\n             }\n         }\n@@ -137,19 +131,19 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n     public void remove(Object entry) {\n         Class<?> entryClass = entry.getClass();\n         checkEntryClass(entryClass, true);\n+\n         if (isLdapSchemaEntry(entryClass)) {\n             if (getSupportedLDAPVersion() > 2) {\n                 merge(entry, true, AttributeModificationType.REMOVE);\n             } else {\n                 throw new UnsupportedOperationException(\"Server doesn't support dynamic schema modifications\");\n             }\n+\n             return;\n         }\n \n         Object dnValue = getDNValue(entry, entryClass);\n-\n         LOG.debug(String.format(\"LDAP entry to remove: %s\", dnValue.toString()));\n-\n         remove(dnValue.toString());\n     }\n \n@@ -159,11 +153,9 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         for (AttributeData attribute : attributes) {\n             String attributeName = attribute.getName();\n             String[] attributeValues = attribute.getValues();\n-\n             if (ArrayHelper.isNotEmpty(attributeValues) && StringHelper.isNotEmpty(attributeValues[0])) {\n                 if (operationService.isCertificateAttribute(attributeName)) {\n                     byte[][] binaryValues = toBinaryValues(attributeValues);\n-\n                     ldapAttributes.add(new Attribute(attributeName + \";binary\", binaryValues));\n                 } else {\n                     ldapAttributes.add(new Attribute(attributeName, attributeValues));\n@@ -172,6 +164,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         // Persist entry\n+\n         try {\n             boolean result = this.operationService.addEntry(dn, ldapAttributes);\n             if (!result) {\n@@ -192,7 +185,6 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n             for (AttributeDataModification attributeDataModification : attributeDataModifications) {\n                 AttributeData attribute = attributeDataModification.getAttribute();\n                 AttributeData oldAttribute = attributeDataModification.getOldAttribute();\n-\n                 String attributeName = null;\n                 String[] attributeValues = null;\n                 if (attribute != null) {\n@@ -219,23 +211,22 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n                         } else {\n                             String[] oldValues = ArrayHelper.arrayClone(oldAttributeValues);\n                             String[] newValues = ArrayHelper.arrayClone(attributeValues);\n-\n                             Arrays.sort(oldValues);\n                             Arrays.sort(newValues);\n \n                             boolean[] retainOldValues = new boolean[oldValues.length];\n                             Arrays.fill(retainOldValues, false);\n-\n                             List<String> addValues = new ArrayList<String>();\n                             List<String> removeValues = new ArrayList<String>();\n \n                             // Add new values\n                             for (String value : newValues) {\n                                 int idx = Arrays.binarySearch(oldValues, value, new Comparator<String>() {\n-                                    @Override\n-                                    public int compare(String o1, String o2) {\n-                                        return o1.toLowerCase().compareTo(o2.toLowerCase());\n-                                    }\n+\n+                                              @Override\n+                                              public int compare(String o1, String o2) {\n+                                                  return o1.toLowerCase().compareTo(o2.toLowerCase());\n+                                              }\n                                 });\n                                 if (idx >= 0) {\n                                     // Old values array contains new value. Retain\n@@ -248,6 +239,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n                             }\n \n                             // Remove values which we don't have in new values\n+\n                             for (int i = 0; i < oldValues.length; i++) {\n                                 if (!retainOldValues[i]) {\n                                     removeValues.add(oldValues[i]);\n@@ -255,14 +247,14 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n                             }\n \n                             if (removeValues.size() > 0) {\n-                                Modification removeModification = createModification(ModificationType.DELETE, attributeName,\n+                                Modification removeModification = createModification(ModificationType.DELETE,\n+                                    attributeName,\n                                         removeValues.toArray(new String[removeValues.size()]));\n                                 modifications.add(removeModification);\n                             }\n \n                             if (addValues.size() > 0) {\n-                                Modification addModification = createModification(ModificationType.ADD, attributeName,\n-                                        addValues.toArray(new String[addValues.size()]));\n+                                Modification addModification = createModification(ModificationType.ADD, attributeName, addValues.toArray(new String[addValues.size()]));\n                                 modifications.add(addModification);\n                             }\n                         }\n@@ -294,6 +286,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n             for (DeleteNotifier subscriber : subscribers) {\n                 subscriber.onBeforeRemove(dn);\n             }\n+\n             this.operationService.delete(dn);\n             for (DeleteNotifier subscriber : subscribers) {\n                 subscriber.onAfterRemove(dn);\n@@ -310,6 +303,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n                 for (DeleteNotifier subscriber : subscribers) {\n                     subscriber.onBeforeRemove(dn);\n                 }\n+\n                 this.operationService.deleteWithSubtree(dn);\n                 for (DeleteNotifier subscriber : subscribers) {\n                     subscriber.onAfterRemove(dn);\n@@ -326,6 +320,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         SearchResult searchResult = null;\n         try {\n             searchResult = this.operationService.search(dn, toLdapFilter(Filter.createPresenceFilter(\"objectClass\")), 0, 0, null, \"dn\");\n+\n             if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n                 throw new EntryPersistenceException(String.format(\"Failed to find sub-entries of entry '%s' for removal\", dn));\n             }\n@@ -337,9 +332,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         for (SearchResultEntry searchResultEntry : searchResult.getSearchEntries()) {\n             removeEntriesDn.add(searchResultEntry.getDN());\n         }\n-\n         Collections.sort(removeEntriesDn, LINE_LENGHT_COMPARATOR);\n-\n         for (String removeEntryDn : removeEntriesDn) {\n             remove(removeEntryDn);\n         }\n@@ -362,8 +355,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n     }\n \n     @Override\n-    public <T> List<T> findEntries(String baseDN, Class<T> entryClass, Filter filter, SearchScope scope, String[] ldapReturnAttributes,\n-            BatchOperation<T> batchOperation, int start, int count, int chunkSize) {\n+    public <T> List<T> findEntries(String baseDN, Class<T> entryClass, Filter filter, SearchScope scope, String[] ldapReturnAttributes, BatchOperation<T> batchOperation, int start, int count, int chunkSize) {\n         if (StringHelper.isEmptyString(baseDN)) {\n             throw new MappingException(\"Base DN to find entries is null\");\n         }\n@@ -378,42 +370,40 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         // Find entries\n+\n         Filter searchFilter;\n         if (objectClasses.length > 0) {\n             searchFilter = addObjectClassFilter(filter, objectClasses);\n         } else {\n             searchFilter = filter;\n         }\n+\n         SearchResult searchResult = null;\n         try {\n-            LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation, this, entryClass,\n-                    propertiesAnnotations);\n-            searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(scope), batchOperationWraper,\n-                    start, chunkSize, count, null, currentLdapReturnAttributes);\n+            LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation, this, entryClass, propertiesAnnotations);\n+            searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(scope), batchOperationWraper, start, chunkSize, count, null, currentLdapReturnAttributes);\n \n             if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n                 throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n             }\n         } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter),\n+                ex);\n         }\n \n         if (searchResult.getEntryCount() == 0) {\n             return new ArrayList<T>(0);\n         }\n \n-        List<T> entries = createEntities(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+        List<T> entries = createEntities(entryClass, propertiesAnnotations, searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n         // Default sort if needed\n         sortEntriesIfNeeded(entryClass, entries);\n-\n         return entries;\n     }\n \n     @Override\n-    public <T> PagedResult<T> findPagedEntries(String baseDN, Class<T> entryClass, Filter filter, String[] ldapReturnAttributes, String sortBy,\n-            SortOrder sortOrder, int start, int count, int chunkSize) {\n+    public <T> PagedResult<T> findPagedEntries(String baseDN, Class<T> entryClass, Filter filter, String[] ldapReturnAttributes, String sortBy, SortOrder sortOrder, int start, int count, int chunkSize) {\n         if (StringHelper.isEmptyString(baseDN)) {\n             throw new MappingException(\"Base DN to find entries is null\");\n         }\n@@ -428,6 +418,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         // Find entries\n+\n         Filter searchFilter;\n         if (objectClasses.length > 0) {\n             searchFilter = addObjectClassFilter(filter, objectClasses);\n@@ -438,26 +429,24 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         List<SearchResultEntry> searchResultEntries;\n         PagedResult<T> vlvResponse = new PagedResult<T>();\n         try {\n-            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n         } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter),\n+                ex);\n         }\n \n         List<T> entries = new ArrayList<T>(0);\n         if (searchResultEntries.size() > 0) {\n-            entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n+            entries = createEntitiesVirtualListView(entryClass,\n+                propertiesAnnotations,\n+                    searchResultEntries.toArray(new SearchResultEntry[] {}));\n         }\n         vlvResponse.setEntries(entries);\n-\n         return vlvResponse;\n-\n     }\n \n     @Deprecated\n-    public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n-            SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n-\n+    public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy, SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n         if (StringHelper.isEmptyString(baseDN)) {\n             throw new MappingException(\"Base DN to find entries is null\");\n         }\n@@ -472,6 +461,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         // Find entries\n+\n         Filter searchFilter;\n         if (objectClasses.length > 0) {\n             searchFilter = addObjectClassFilter(filter, objectClasses);\n@@ -481,24 +471,21 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         SearchResult searchResult = null;\n         try {\n-\n-            searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+            searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n \n             if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n                 throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n             }\n-\n         } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter),\n+                ex);\n         }\n \n         if (searchResult.getEntryCount() == 0) {\n             return new ArrayList<T>(0);\n         }\n \n-        List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+        List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n         return entries;\n     }\n@@ -510,6 +497,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         // Create filter\n+\n         Filter searchFilter;\n         if (objectClasses.length > 0) {\n             searchFilter = addObjectClassFilter(filter, objectClasses);\n@@ -520,23 +508,23 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         SearchResult searchResult = null;\n         try {\n             searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n+\n             if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n                 throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n             }\n         } catch (SearchException ex) {\n             if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter),\n+                    ex);\n             }\n         }\n \n         return (searchResult != null) && (searchResult.getEntryCount() > 0);\n     }\n \n-    protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n+    protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations, SearchResultEntry... searchResultEntries) {\n         List<T> result = new ArrayList<T>(searchResultEntries.length);\n         Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n-\n         int count = 0;\n         for (int i = 0; i < searchResultEntries.length; i++) {\n             count++;\n@@ -547,10 +535,10 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n             searchResultEntries[i] = null;\n \n             // Allow java to clean up temporary objects\n+\n             if (count >= 100) {\n                 List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n                 result.addAll(currentResult);\n-\n                 entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n                 count = 0;\n             }\n@@ -558,24 +546,17 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n         result.addAll(currentResult);\n-\n         return result;\n     }\n \n     @Deprecated\n-    private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n-\n+    private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations, SearchResultEntry... searchResultEntries) {\n         List<T> result = new LinkedList<T>();\n         Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n-\n         int count = 0;\n         for (int i = 0; i < searchResultEntries.length; i++) {\n-\n             count++;\n-\n             SearchResultEntry entry = searchResultEntries[i];\n-\n             LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n             attributeDataLinkedList.addAll(getAttributeDataList(entry));\n             entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n@@ -584,12 +565,11 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n             searchResultEntries[i] = null;\n \n             // Allow java to clean up temporary objects\n-            if (count >= 100) {\n \n+            if (count >= 100) {\n                 List<T> currentResult = new LinkedList<T>();\n                 currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n                 result.addAll(currentResult);\n-\n                 entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n                 count = 0;\n             }\n@@ -597,7 +577,6 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n         result.addAll(currentResult);\n-\n         return result;\n     }\n \n@@ -612,28 +591,25 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n             String attributeName = attribute.getName();\n             if (LOG.isTraceEnabled()) {\n                 if (attribute.needsBase64Encoding()) {\n-                    LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n-                            + operationService.isBinaryAttribute(attributeName));\n+                    LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \" + operationService.isBinaryAttribute(attributeName));\n                 }\n             }\n-\n             attributeValueStrings = attribute.getValues();\n+\n             if (attribute.needsBase64Encoding()) {\n                 boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n                 boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n-\n                 if (binaryAttribute || certificateAttribute) {\n                     byte[][] attributeValues = attribute.getValueByteArrays();\n                     if (attributeValues != null) {\n                         attributeValueStrings = new String[attributeValues.length];\n                         for (int i = 0; i < attributeValues.length; i++) {\n                             attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n-                            LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n-                                    + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n-                                    + attributeValueStrings[i]);\n+                            LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \" + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \" + attributeValueStrings[i]);\n                         }\n                     }\n                 }\n+\n                 if (certificateAttribute) {\n                     attributeName = operationService.getCertificateAttributeName(attributeName);\n                 }\n@@ -694,14 +670,13 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         }\n \n         CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n-\n         try {\n             LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n-            operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n-                    ldapReturnAttributes);\n+            operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null, ldapReturnAttributes);\n         } catch (Exception ex) {\n-            throw new EntryPersistenceException(\n-                    String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+            throw new EntryPersistenceException(String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\",\n+                baseDN,\n+                    searchFilter), ex);\n         }\n \n         return batchOperation.getCountEntries();\n@@ -735,6 +710,7 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         try {\n             connection = operationService.getConnection();\n             ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n+\n             return ResultCode.SUCCESS.equals(result);\n         } catch (Exception ex) {\n             LOG.error(\"Failed to load ldif file\", ex);\n@@ -799,6 +775,6 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n         public int getCountEntries() {\n             return countEntries;\n         }\n-    }\n \n-}\n+    }\n+}\n\\ No newline at end of file\n",
            "diff_size": 117
        },
        {
            "tool": "styler_random",
            "errors": [
                {
                    "line": "440",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 156).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "440",
                    "column": "13",
                    "severity": "error",
                    "message": "'{' at column 13 should have line break after.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.blocks.LeftCurlyCheck"
                },
                {
                    "line": "440",
                    "column": "13",
                    "severity": "error",
                    "message": "'{' is not followed by whitespace.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.whitespace.WhitespaceAroundCheck"
                }
            ],
            "diff": "diff --git a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/styler_random/117/LdapEntryManager.java\nindex f32c25786c..bf01505b06 100644\n--- a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java\n+++ b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/styler_random/117/LdapEntryManager.java\n@@ -437,368 +437,367 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         List<SearchResultEntry> searchResultEntries;\n         PagedResult<T> vlvResponse = new PagedResult<T>();\n-        try {\n-            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n-\n-        List<T> entries = new ArrayList<T>(0);\n-        if (searchResultEntries.size() > 0) {\n-            entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n-        }\n-        vlvResponse.setEntries(entries);\n-\n-        return vlvResponse;\n+        try {searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+                start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+    }\n \n+    List<T> entries = new ArrayList<T>(0);\n+    if (searchResultEntries.size() > 0) {\n+        entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n     }\n+    vlvResponse.setEntries(entries);\n \n-    @Deprecated\n-    public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n-            SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n+    return vlvResponse;\n \n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to find entries is null\");\n-        }\n+}\n \n-        // Check entry class\n-        checkEntryClass(entryClass, false);\n-        String[] objectClasses = getTypeObjectClasses(entryClass);\n-        List<PropertyAnnotation> propertiesAnnotations = getEntryPropertyAnnotations(entryClass);\n-        String[] currentLdapReturnAttributes = ldapReturnAttributes;\n-        if (ArrayHelper.isEmpty(currentLdapReturnAttributes)) {\n-            currentLdapReturnAttributes = getLdapAttributes(null, propertiesAnnotations, false);\n-        }\n+@Deprecated\n+public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n+        SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n \n-        // Find entries\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to find entries is null\");\n+    }\n \n-        SearchResult searchResult = null;\n-        try {\n+    // Check entry class\n+    checkEntryClass(entryClass, false);\n+    String[] objectClasses = getTypeObjectClasses(entryClass);\n+    List<PropertyAnnotation> propertiesAnnotations = getEntryPropertyAnnotations(entryClass);\n+    String[] currentLdapReturnAttributes = ldapReturnAttributes;\n+    if (ArrayHelper.isEmpty(currentLdapReturnAttributes)) {\n+        currentLdapReturnAttributes = getLdapAttributes(null, propertiesAnnotations, false);\n+    }\n \n-            searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+    // Find entries\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n+    }\n \n-            if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n-            }\n+    SearchResult searchResult = null;\n+    try {\n \n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n+        searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+                start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n \n-        if (searchResult.getEntryCount() == 0) {\n-            return new ArrayList<T>(0);\n+        if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n         }\n \n-        List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+    }\n \n-        return entries;\n+    if (searchResult.getEntryCount() == 0) {\n+        return new ArrayList<T>(0);\n     }\n \n-    @Override\n-    protected boolean contains(String baseDN, Filter filter, String[] objectClasses, String[] ldapReturnAttributes) {\n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to check contain entries is null\");\n-        }\n+    List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n+            searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n-        // Create filter\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    return entries;\n+}\n \n-        SearchResult searchResult = null;\n-        try {\n-            searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n-            if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n-            }\n-        } catch (SearchException ex) {\n-            if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-            }\n-        }\n+@Override\n+protected boolean contains(String baseDN, Filter filter, String[] objectClasses, String[] ldapReturnAttributes) {\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to check contain entries is null\");\n+    }\n \n-        return (searchResult != null) && (searchResult.getEntryCount() > 0);\n+    // Create filter\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n     }\n \n-    protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n-        List<T> result = new ArrayList<T>(searchResultEntries.length);\n-        Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n+    SearchResult searchResult = null;\n+    try {\n+        searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n+        if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n+        }\n+    } catch (SearchException ex) {\n+        if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+        }\n+    }\n \n-        int count = 0;\n-        for (int i = 0; i < searchResultEntries.length; i++) {\n-            count++;\n-            SearchResultEntry entry = searchResultEntries[i];\n-            entriesAttributes.put(entry.getDN(), getAttributeDataList(entry));\n+    return (searchResult != null) && (searchResult.getEntryCount() > 0);\n+}\n \n-            // Remove reference to allow java clean up object\n-            searchResultEntries[i] = null;\n+protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n+        SearchResultEntry... searchResultEntries) {\n+    List<T> result = new ArrayList<T>(searchResultEntries.length);\n+    Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n \n-            // Allow java to clean up temporary objects\n-            if (count >= 100) {\n-                List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n-                result.addAll(currentResult);\n+    int count = 0;\n+    for (int i = 0; i < searchResultEntries.length; i++) {\n+        count++;\n+        SearchResultEntry entry = searchResultEntries[i];\n+        entriesAttributes.put(entry.getDN(), getAttributeDataList(entry));\n \n-                entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n-                count = 0;\n-            }\n-        }\n+        // Remove reference to allow java clean up object\n+        searchResultEntries[i] = null;\n \n-        List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n-        result.addAll(currentResult);\n+        // Allow java to clean up temporary objects\n+        if (count >= 100) {\n+            List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n+            result.addAll(currentResult);\n \n-        return result;\n+            entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n+            count = 0;\n+        }\n     }\n \n-    @Deprecated\n-    private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n+    List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n+    result.addAll(currentResult);\n \n-        List<T> result = new LinkedList<T>();\n-        Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n+    return result;\n+}\n \n-        int count = 0;\n-        for (int i = 0; i < searchResultEntries.length; i++) {\n+@Deprecated\n+private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n+        SearchResultEntry... searchResultEntries) {\n \n-            count++;\n+    List<T> result = new LinkedList<T>();\n+    Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n \n-            SearchResultEntry entry = searchResultEntries[i];\n+    int count = 0;\n+    for (int i = 0; i < searchResultEntries.length; i++) {\n \n-            LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n-            attributeDataLinkedList.addAll(getAttributeDataList(entry));\n-            entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n+        count++;\n \n-            // Remove reference to allow java clean up object\n-            searchResultEntries[i] = null;\n+        SearchResultEntry entry = searchResultEntries[i];\n \n-            // Allow java to clean up temporary objects\n-            if (count >= 100) {\n+        LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n+        attributeDataLinkedList.addAll(getAttributeDataList(entry));\n+        entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n \n-                List<T> currentResult = new LinkedList<T>();\n-                currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n-                result.addAll(currentResult);\n+        // Remove reference to allow java clean up object\n+        searchResultEntries[i] = null;\n \n-                entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n-                count = 0;\n-            }\n-        }\n+        // Allow java to clean up temporary objects\n+        if (count >= 100) {\n \n-        List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n-        result.addAll(currentResult);\n+            List<T> currentResult = new LinkedList<T>();\n+            currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n+            result.addAll(currentResult);\n \n-        return result;\n+            entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n+            count = 0;\n+        }\n     }\n \n-    private List<AttributeData> getAttributeDataList(SearchResultEntry entry) {\n-        if (entry == null) {\n-            return null;\n-        }\n+    List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n+    result.addAll(currentResult);\n \n-        List<AttributeData> result = new ArrayList<AttributeData>();\n-        for (Attribute attribute : entry.getAttributes()) {\n-            String[] attributeValueStrings = NO_STRINGS;\n-            String attributeName = attribute.getName();\n-            if (LOG.isTraceEnabled()) {\n-                if (attribute.needsBase64Encoding()) {\n-                    LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n-                            + operationService.isBinaryAttribute(attributeName));\n-                }\n-            }\n+    return result;\n+}\n \n-            attributeValueStrings = attribute.getValues();\n+private List<AttributeData> getAttributeDataList(SearchResultEntry entry) {\n+    if (entry == null) {\n+        return null;\n+    }\n+\n+    List<AttributeData> result = new ArrayList<AttributeData>();\n+    for (Attribute attribute : entry.getAttributes()) {\n+        String[] attributeValueStrings = NO_STRINGS;\n+        String attributeName = attribute.getName();\n+        if (LOG.isTraceEnabled()) {\n             if (attribute.needsBase64Encoding()) {\n-                boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n-                boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n-\n-                if (binaryAttribute || certificateAttribute) {\n-                    byte[][] attributeValues = attribute.getValueByteArrays();\n-                    if (attributeValues != null) {\n-                        attributeValueStrings = new String[attributeValues.length];\n-                        for (int i = 0; i < attributeValues.length; i++) {\n-                            attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n-                            LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n-                                    + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n-                                    + attributeValueStrings[i]);\n-                        }\n+                LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n+                        + operationService.isBinaryAttribute(attributeName));\n+            }\n+        }\n+\n+        attributeValueStrings = attribute.getValues();\n+        if (attribute.needsBase64Encoding()) {\n+            boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n+            boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n+\n+            if (binaryAttribute || certificateAttribute) {\n+                byte[][] attributeValues = attribute.getValueByteArrays();\n+                if (attributeValues != null) {\n+                    attributeValueStrings = new String[attributeValues.length];\n+                    for (int i = 0; i < attributeValues.length; i++) {\n+                        attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n+                        LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n+                                + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n+                                + attributeValueStrings[i]);\n                     }\n                 }\n-                if (certificateAttribute) {\n-                    attributeName = operationService.getCertificateAttributeName(attributeName);\n-                }\n             }\n-\n-            AttributeData tmpAttribute = new AttributeData(attributeName, attributeValueStrings);\n-            result.add(tmpAttribute);\n+            if (certificateAttribute) {\n+                attributeName = operationService.getCertificateAttributeName(attributeName);\n+            }\n         }\n \n-        return result;\n+        AttributeData tmpAttribute = new AttributeData(attributeName, attributeValueStrings);\n+        result.add(tmpAttribute);\n     }\n \n-    @Override\n-    public boolean authenticate(String baseDN, String userName, String password) {\n-        try {\n-            Filter filter = Filter.createEqualityFilter(LdapOperationsServiceImpl.UID, userName);\n-            SearchResult searchResult = operationService.search(baseDN, toLdapFilter(filter), 1, 1);\n-            if ((searchResult == null) || (searchResult.getEntryCount() != 1)) {\n-                return false;\n-            }\n-\n-            String bindDn = searchResult.getSearchEntries().get(0).getDN();\n+    return result;\n+}\n \n-            return operationService.authenticate(bindDn, password);\n-        } catch (ConnectionException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to authenticate user: %s\", userName), ex);\n-        } catch (SearchException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to find user DN: %s\", userName), ex);\n+@Override\n+public boolean authenticate(String baseDN, String userName, String password) {\n+    try {\n+        Filter filter = Filter.createEqualityFilter(LdapOperationsServiceImpl.UID, userName);\n+        SearchResult searchResult = operationService.search(baseDN, toLdapFilter(filter), 1, 1);\n+        if ((searchResult == null) || (searchResult.getEntryCount() != 1)) {\n+            return false;\n         }\n-    }\n \n-    @Override\n-    public boolean authenticate(String bindDn, String password) {\n-        try {\n-            return operationService.authenticate(bindDn, password);\n-        } catch (ConnectionException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to authenticate DN: %s\", bindDn), ex);\n-        }\n+        String bindDn = searchResult.getSearchEntries().get(0).getDN();\n+\n+        return operationService.authenticate(bindDn, password);\n+    } catch (ConnectionException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to authenticate user: %s\", userName), ex);\n+    } catch (SearchException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to find user DN: %s\", userName), ex);\n     }\n+}\n \n-    @Override\n-    public <T> int countEntries(String baseDN, Class<T> entryClass, Filter filter) {\n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to find entries is null\");\n-        }\n+@Override\n+public boolean authenticate(String bindDn, String password) {\n+    try {\n+        return operationService.authenticate(bindDn, password);\n+    } catch (ConnectionException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to authenticate DN: %s\", bindDn), ex);\n+    }\n+}\n \n-        // Check entry class\n-        checkEntryClass(entryClass, false);\n-        String[] objectClasses = getTypeObjectClasses(entryClass);\n-        String[] ldapReturnAttributes = new String[] {\"\"}; // Don't load attributes\n+@Override\n+public <T> int countEntries(String baseDN, Class<T> entryClass, Filter filter) {\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to find entries is null\");\n+    }\n \n-        // Find entries\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    // Check entry class\n+    checkEntryClass(entryClass, false);\n+    String[] objectClasses = getTypeObjectClasses(entryClass);\n+    String[] ldapReturnAttributes = new String[] {\"\"}; // Don't load attributes\n \n-        CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n+    // Find entries\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n+    }\n \n-        try {\n-            LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n-            operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n-                    ldapReturnAttributes);\n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(\n-                    String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n+    CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n \n-        return batchOperation.getCountEntries();\n+    try {\n+        LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n+        operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n+                ldapReturnAttributes);\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(\n+                String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n     }\n \n-    @Override\n-    public String encodeTime(Date date) {\n-        if (date == null) {\n-            return null;\n-        }\n+    return batchOperation.getCountEntries();\n+}\n \n-        return StaticUtils.encodeGeneralizedTime(date);\n+@Override\n+public String encodeTime(Date date) {\n+    if (date == null) {\n+        return null;\n     }\n \n-    public Date decodeTime(String date) {\n-        if (date == null) {\n-            return null;\n-        }\n-\n-        try {\n-            return StaticUtils.decodeGeneralizedTime(date);\n-        } catch (ParseException ex) {\n-            LOG.error(\"Failed to parse generalized time {}\", date, ex);\n-        }\n+    return StaticUtils.encodeGeneralizedTime(date);\n+}\n \n+public Date decodeTime(String date) {\n+    if (date == null) {\n         return null;\n     }\n \n-    public boolean loadLdifFileContent(String ldifFileContent) {\n-        LDAPConnection connection = null;\n-        try {\n-            connection = operationService.getConnection();\n-            ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n-            return ResultCode.SUCCESS.equals(result);\n-        } catch (Exception ex) {\n-            LOG.error(\"Failed to load ldif file\", ex);\n-            return false;\n-        } finally {\n-            if (connection != null) {\n-                operationService.releaseConnection(connection);\n-            }\n-        }\n+    try {\n+        return StaticUtils.decodeGeneralizedTime(date);\n+    } catch (ParseException ex) {\n+        LOG.error(\"Failed to parse generalized time {}\", date, ex);\n     }\n \n-    @Override\n-    public String[] exportEntry(String dn) {\n-        String[] ldif = null;\n-        try {\n-            ldif = this.operationService.lookup(dn).toLDIF();\n-        } catch (ConnectionException e) {\n-            LOG.error(\"Failed get ldif from \" + dn, e);\n-        }\n+    return null;\n+}\n \n-        return ldif;\n+public boolean loadLdifFileContent(String ldifFileContent) {\n+    LDAPConnection connection = null;\n+    try {\n+        connection = operationService.getConnection();\n+        ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n+        return ResultCode.SUCCESS.equals(result);\n+    } catch (Exception ex) {\n+        LOG.error(\"Failed to load ldif file\", ex);\n+        return false;\n+    } finally {\n+        if (connection != null) {\n+            operationService.releaseConnection(connection);\n+        }\n     }\n+}\n \n-    public int getSupportedLDAPVersion() {\n-        return this.operationService.getSupportedLDAPVersion();\n+@Override\n+public String[] exportEntry(String dn) {\n+    String[] ldif = null;\n+    try {\n+        ldif = this.operationService.lookup(dn).toLDIF();\n+    } catch (ConnectionException e) {\n+        LOG.error(\"Failed get ldif from \" + dn, e);\n     }\n \n-    private Modification createModification(final ModificationType modificationType, final String attributeName, final String... attributeValues) {\n-        String realAttributeName = attributeName;\n-        if (operationService.isCertificateAttribute(realAttributeName)) {\n-            realAttributeName += \";binary\";\n-            byte[][] binaryValues = toBinaryValues(attributeValues);\n+    return ldif;\n+}\n \n-            return new Modification(modificationType, realAttributeName, binaryValues);\n-        }\n+public int getSupportedLDAPVersion() {\n+    return this.operationService.getSupportedLDAPVersion();\n+}\n \n-        return new Modification(modificationType, realAttributeName, attributeValues);\n-    }\n+private Modification createModification(final ModificationType modificationType, final String attributeName, final String... attributeValues) {\n+    String realAttributeName = attributeName;\n+    if (operationService.isCertificateAttribute(realAttributeName)) {\n+        realAttributeName += \";binary\";\n+        byte[][] binaryValues = toBinaryValues(attributeValues);\n \n-    private com.unboundid.ldap.sdk.Filter toLdapFilter(Filter genericFilter) throws SearchException {\n-        return LDAP_FILTER_CONVERTER.convertToLdapFilter(genericFilter);\n+        return new Modification(modificationType, realAttributeName, binaryValues);\n     }\n \n-    private com.unboundid.ldap.sdk.SearchScope toLdapSearchScope(SearchScope scope) throws SearchScopeException {\n-        return LDAP_SEARCH_SCOPE_CONVERTER.convertToLdapSearchScope(scope);\n-    }\n+    return new Modification(modificationType, realAttributeName, attributeValues);\n+}\n \n-    private static final class CountBatchOperation<T> extends DefaultBatchOperation<T> {\n+private com.unboundid.ldap.sdk.Filter toLdapFilter(Filter genericFilter) throws SearchException {\n+    return LDAP_FILTER_CONVERTER.convertToLdapFilter(genericFilter);\n+}\n \n-        private int countEntries = 0;\n+private com.unboundid.ldap.sdk.SearchScope toLdapSearchScope(SearchScope scope) throws SearchScopeException {\n+    return LDAP_SEARCH_SCOPE_CONVERTER.convertToLdapSearchScope(scope);\n+}\n \n-        @Override\n-        public void performAction(List<T> entries) {\n-        }\n+private static final class CountBatchOperation<T> extends DefaultBatchOperation<T> {\n \n-        @Override\n-        public boolean collectSearchResult(int size) {\n-            countEntries += size;\n-            return false;\n-        }\n+    private int countEntries = 0;\n \n-        public int getCountEntries() {\n-            return countEntries;\n-        }\n+    @Override\n+    public void performAction(List<T> entries) {\n+    }\n+\n+    @Override\n+    public boolean collectSearchResult(int size) {\n+        countEntries += size;\n+        return false;\n     }\n \n+    public int getCountEntries() {\n+        return countEntries;\n+    }\n+}\n+\n }\n",
            "diff_size": 393
        },
        {
            "tool": "styler_three_grams",
            "errors": [
                {
                    "line": "440",
                    "severity": "error",
                    "message": "Line is longer than 150 characters (found 155).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "440",
                    "column": "13",
                    "severity": "error",
                    "message": "'{' at column 13 should have line break after.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.blocks.LeftCurlyCheck"
                },
                {
                    "line": "440",
                    "column": "34",
                    "severity": "error",
                    "message": "'=' is not followed by whitespace.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.whitespace.WhitespaceAroundCheck"
                },
                {
                    "line": "440",
                    "column": "34",
                    "severity": "error",
                    "message": "'=' is not preceded with whitespace.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.whitespace.WhitespaceAroundCheck"
                }
            ],
            "diff": "diff --git a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/styler_three_grams/117/LdapEntryManager.java\nindex f32c25786c..f61732f02c 100644\n--- a/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/errored/1/117/LdapEntryManager.java\n+++ b/home/thomas/mnt/fernanda/styler-test2/python/./experiments/projects/../results/GluuFederation-oxCore/styler_three_grams/117/LdapEntryManager.java\n@@ -437,368 +437,367 @@ public class LdapEntryManager extends BaseEntryManager implements Serializable {\n \n         List<SearchResultEntry> searchResultEntries;\n         PagedResult<T> vlvResponse = new PagedResult<T>();\n-        try {\n-            searchResultEntries = this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n-\n-        List<T> entries = new ArrayList<T>(0);\n-        if (searchResultEntries.size() > 0) {\n-            entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n-        }\n-        vlvResponse.setEntries(entries);\n-\n-        return vlvResponse;\n+        try { searchResultEntries=this.operationService.searchSearchResultEntryList(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+                start, count, chunkSize, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+    }\n \n+    List<T> entries = new ArrayList<T>(0);\n+    if (searchResultEntries.size() > 0) {\n+        entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations, searchResultEntries.toArray(new SearchResultEntry[]{}));\n     }\n+    vlvResponse.setEntries(entries);\n \n-    @Deprecated\n-    public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n-            SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n+    return vlvResponse;\n \n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to find entries is null\");\n-        }\n+}\n \n-        // Check entry class\n-        checkEntryClass(entryClass, false);\n-        String[] objectClasses = getTypeObjectClasses(entryClass);\n-        List<PropertyAnnotation> propertiesAnnotations = getEntryPropertyAnnotations(entryClass);\n-        String[] currentLdapReturnAttributes = ldapReturnAttributes;\n-        if (ArrayHelper.isEmpty(currentLdapReturnAttributes)) {\n-            currentLdapReturnAttributes = getLdapAttributes(null, propertiesAnnotations, false);\n-        }\n+@Deprecated\n+public <T> List<T> findEntriesVirtualListView(String baseDN, Class<T> entryClass, Filter filter, int start, int count, String sortBy,\n+        SortOrder sortOrder, PagedResult vlvResponse, String[] ldapReturnAttributes) {\n \n-        // Find entries\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to find entries is null\");\n+    }\n \n-        SearchResult searchResult = null;\n-        try {\n+    // Check entry class\n+    checkEntryClass(entryClass, false);\n+    String[] objectClasses = getTypeObjectClasses(entryClass);\n+    List<PropertyAnnotation> propertiesAnnotations = getEntryPropertyAnnotations(entryClass);\n+    String[] currentLdapReturnAttributes = ldapReturnAttributes;\n+    if (ArrayHelper.isEmpty(currentLdapReturnAttributes)) {\n+        currentLdapReturnAttributes = getLdapAttributes(null, propertiesAnnotations, false);\n+    }\n \n-            searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n-                    start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n+    // Find entries\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n+    }\n \n-            if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n-            }\n+    SearchResult searchResult = null;\n+    try {\n \n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n+        searchResult = this.operationService.searchVirtualListView(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB),\n+                start, count, sortBy, sortOrder, vlvResponse, currentLdapReturnAttributes);\n \n-        if (searchResult.getEntryCount() == 0) {\n-            return new ArrayList<T>(0);\n+        if (!ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter));\n         }\n \n-        List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n-                searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(String.format(\"Failed to find entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+    }\n \n-        return entries;\n+    if (searchResult.getEntryCount() == 0) {\n+        return new ArrayList<T>(0);\n     }\n \n-    @Override\n-    protected boolean contains(String baseDN, Filter filter, String[] objectClasses, String[] ldapReturnAttributes) {\n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to check contain entries is null\");\n-        }\n+    List<T> entries = createEntitiesVirtualListView(entryClass, propertiesAnnotations,\n+            searchResult.getSearchEntries().toArray(new SearchResultEntry[searchResult.getSearchEntries().size()]));\n \n-        // Create filter\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    return entries;\n+}\n \n-        SearchResult searchResult = null;\n-        try {\n-            searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n-            if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n-            }\n-        } catch (SearchException ex) {\n-            if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n-                throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-            }\n-        }\n+@Override\n+protected boolean contains(String baseDN, Filter filter, String[] objectClasses, String[] ldapReturnAttributes) {\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to check contain entries is null\");\n+    }\n \n-        return (searchResult != null) && (searchResult.getEntryCount() > 0);\n+    // Create filter\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n     }\n \n-    protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n-        List<T> result = new ArrayList<T>(searchResultEntries.length);\n-        Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n+    SearchResult searchResult = null;\n+    try {\n+        searchResult = this.operationService.search(baseDN, toLdapFilter(searchFilter), 1, 1, null, ldapReturnAttributes);\n+        if ((searchResult == null) || !ResultCode.SUCCESS.equals(searchResult.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter));\n+        }\n+    } catch (SearchException ex) {\n+        if (!(ResultCode.NO_SUCH_OBJECT_INT_VALUE == ex.getResultCode())) {\n+            throw new EntryPersistenceException(String.format(\"Failed to find entry with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n+        }\n+    }\n \n-        int count = 0;\n-        for (int i = 0; i < searchResultEntries.length; i++) {\n-            count++;\n-            SearchResultEntry entry = searchResultEntries[i];\n-            entriesAttributes.put(entry.getDN(), getAttributeDataList(entry));\n+    return (searchResult != null) && (searchResult.getEntryCount() > 0);\n+}\n \n-            // Remove reference to allow java clean up object\n-            searchResultEntries[i] = null;\n+protected <T> List<T> createEntities(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n+        SearchResultEntry... searchResultEntries) {\n+    List<T> result = new ArrayList<T>(searchResultEntries.length);\n+    Map<String, List<AttributeData>> entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n \n-            // Allow java to clean up temporary objects\n-            if (count >= 100) {\n-                List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n-                result.addAll(currentResult);\n+    int count = 0;\n+    for (int i = 0; i < searchResultEntries.length; i++) {\n+        count++;\n+        SearchResultEntry entry = searchResultEntries[i];\n+        entriesAttributes.put(entry.getDN(), getAttributeDataList(entry));\n \n-                entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n-                count = 0;\n-            }\n-        }\n+        // Remove reference to allow java clean up object\n+        searchResultEntries[i] = null;\n \n-        List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n-        result.addAll(currentResult);\n+        // Allow java to clean up temporary objects\n+        if (count >= 100) {\n+            List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n+            result.addAll(currentResult);\n \n-        return result;\n+            entriesAttributes = new HashMap<String, List<AttributeData>>(100);\n+            count = 0;\n+        }\n     }\n \n-    @Deprecated\n-    private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n-            SearchResultEntry... searchResultEntries) {\n+    List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes);\n+    result.addAll(currentResult);\n \n-        List<T> result = new LinkedList<T>();\n-        Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n+    return result;\n+}\n \n-        int count = 0;\n-        for (int i = 0; i < searchResultEntries.length; i++) {\n+@Deprecated\n+private <T> List<T> createEntitiesVirtualListView(Class<T> entryClass, List<PropertyAnnotation> propertiesAnnotations,\n+        SearchResultEntry... searchResultEntries) {\n \n-            count++;\n+    List<T> result = new LinkedList<T>();\n+    Map<String, List<AttributeData>> entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n \n-            SearchResultEntry entry = searchResultEntries[i];\n+    int count = 0;\n+    for (int i = 0; i < searchResultEntries.length; i++) {\n \n-            LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n-            attributeDataLinkedList.addAll(getAttributeDataList(entry));\n-            entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n+        count++;\n \n-            // Remove reference to allow java clean up object\n-            searchResultEntries[i] = null;\n+        SearchResultEntry entry = searchResultEntries[i];\n \n-            // Allow java to clean up temporary objects\n-            if (count >= 100) {\n+        LinkedList<AttributeData> attributeDataLinkedList = new LinkedList<AttributeData>();\n+        attributeDataLinkedList.addAll(getAttributeDataList(entry));\n+        entriesAttributes.put(entry.getDN(), attributeDataLinkedList);\n \n-                List<T> currentResult = new LinkedList<T>();\n-                currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n-                result.addAll(currentResult);\n+        // Remove reference to allow java clean up object\n+        searchResultEntries[i] = null;\n \n-                entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n-                count = 0;\n-            }\n-        }\n+        // Allow java to clean up temporary objects\n+        if (count >= 100) {\n \n-        List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n-        result.addAll(currentResult);\n+            List<T> currentResult = new LinkedList<T>();\n+            currentResult.addAll(createEntities(entryClass, propertiesAnnotations, entriesAttributes, false));\n+            result.addAll(currentResult);\n \n-        return result;\n+            entriesAttributes = new LinkedHashMap<String, List<AttributeData>>(100);\n+            count = 0;\n+        }\n     }\n \n-    private List<AttributeData> getAttributeDataList(SearchResultEntry entry) {\n-        if (entry == null) {\n-            return null;\n-        }\n+    List<T> currentResult = createEntities(entryClass, propertiesAnnotations, entriesAttributes, false);\n+    result.addAll(currentResult);\n \n-        List<AttributeData> result = new ArrayList<AttributeData>();\n-        for (Attribute attribute : entry.getAttributes()) {\n-            String[] attributeValueStrings = NO_STRINGS;\n-            String attributeName = attribute.getName();\n-            if (LOG.isTraceEnabled()) {\n-                if (attribute.needsBase64Encoding()) {\n-                    LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n-                            + operationService.isBinaryAttribute(attributeName));\n-                }\n-            }\n+    return result;\n+}\n \n-            attributeValueStrings = attribute.getValues();\n+private List<AttributeData> getAttributeDataList(SearchResultEntry entry) {\n+    if (entry == null) {\n+        return null;\n+    }\n+\n+    List<AttributeData> result = new ArrayList<AttributeData>();\n+    for (Attribute attribute : entry.getAttributes()) {\n+        String[] attributeValueStrings = NO_STRINGS;\n+        String attributeName = attribute.getName();\n+        if (LOG.isTraceEnabled()) {\n             if (attribute.needsBase64Encoding()) {\n-                boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n-                boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n-\n-                if (binaryAttribute || certificateAttribute) {\n-                    byte[][] attributeValues = attribute.getValueByteArrays();\n-                    if (attributeValues != null) {\n-                        attributeValueStrings = new String[attributeValues.length];\n-                        for (int i = 0; i < attributeValues.length; i++) {\n-                            attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n-                            LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n-                                    + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n-                                    + attributeValueStrings[i]);\n-                        }\n+                LOG.trace(\"Found binary attribute: \" + attributeName + \". Is defined in LDAP config: \"\n+                        + operationService.isBinaryAttribute(attributeName));\n+            }\n+        }\n+\n+        attributeValueStrings = attribute.getValues();\n+        if (attribute.needsBase64Encoding()) {\n+            boolean binaryAttribute = operationService.isBinaryAttribute(attributeName);\n+            boolean certificateAttribute = operationService.isCertificateAttribute(attributeName);\n+\n+            if (binaryAttribute || certificateAttribute) {\n+                byte[][] attributeValues = attribute.getValueByteArrays();\n+                if (attributeValues != null) {\n+                    attributeValueStrings = new String[attributeValues.length];\n+                    for (int i = 0; i < attributeValues.length; i++) {\n+                        attributeValueStrings[i] = Base64.encodeBase64String(attributeValues[i]);\n+                        LOG.trace(\"Binary attribute: \" + attribute.getName() + \" value (hex): \"\n+                                + org.apache.commons.codec.binary.Hex.encodeHexString(attributeValues[i]) + \" value (base64): \"\n+                                + attributeValueStrings[i]);\n                     }\n                 }\n-                if (certificateAttribute) {\n-                    attributeName = operationService.getCertificateAttributeName(attributeName);\n-                }\n             }\n-\n-            AttributeData tmpAttribute = new AttributeData(attributeName, attributeValueStrings);\n-            result.add(tmpAttribute);\n+            if (certificateAttribute) {\n+                attributeName = operationService.getCertificateAttributeName(attributeName);\n+            }\n         }\n \n-        return result;\n+        AttributeData tmpAttribute = new AttributeData(attributeName, attributeValueStrings);\n+        result.add(tmpAttribute);\n     }\n \n-    @Override\n-    public boolean authenticate(String baseDN, String userName, String password) {\n-        try {\n-            Filter filter = Filter.createEqualityFilter(LdapOperationsServiceImpl.UID, userName);\n-            SearchResult searchResult = operationService.search(baseDN, toLdapFilter(filter), 1, 1);\n-            if ((searchResult == null) || (searchResult.getEntryCount() != 1)) {\n-                return false;\n-            }\n-\n-            String bindDn = searchResult.getSearchEntries().get(0).getDN();\n+    return result;\n+}\n \n-            return operationService.authenticate(bindDn, password);\n-        } catch (ConnectionException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to authenticate user: %s\", userName), ex);\n-        } catch (SearchException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to find user DN: %s\", userName), ex);\n+@Override\n+public boolean authenticate(String baseDN, String userName, String password) {\n+    try {\n+        Filter filter = Filter.createEqualityFilter(LdapOperationsServiceImpl.UID, userName);\n+        SearchResult searchResult = operationService.search(baseDN, toLdapFilter(filter), 1, 1);\n+        if ((searchResult == null) || (searchResult.getEntryCount() != 1)) {\n+            return false;\n         }\n-    }\n \n-    @Override\n-    public boolean authenticate(String bindDn, String password) {\n-        try {\n-            return operationService.authenticate(bindDn, password);\n-        } catch (ConnectionException ex) {\n-            throw new AuthenticationException(String.format(\"Failed to authenticate DN: %s\", bindDn), ex);\n-        }\n+        String bindDn = searchResult.getSearchEntries().get(0).getDN();\n+\n+        return operationService.authenticate(bindDn, password);\n+    } catch (ConnectionException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to authenticate user: %s\", userName), ex);\n+    } catch (SearchException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to find user DN: %s\", userName), ex);\n     }\n+}\n \n-    @Override\n-    public <T> int countEntries(String baseDN, Class<T> entryClass, Filter filter) {\n-        if (StringHelper.isEmptyString(baseDN)) {\n-            throw new MappingException(\"Base DN to find entries is null\");\n-        }\n+@Override\n+public boolean authenticate(String bindDn, String password) {\n+    try {\n+        return operationService.authenticate(bindDn, password);\n+    } catch (ConnectionException ex) {\n+        throw new AuthenticationException(String.format(\"Failed to authenticate DN: %s\", bindDn), ex);\n+    }\n+}\n \n-        // Check entry class\n-        checkEntryClass(entryClass, false);\n-        String[] objectClasses = getTypeObjectClasses(entryClass);\n-        String[] ldapReturnAttributes = new String[] {\"\"}; // Don't load attributes\n+@Override\n+public <T> int countEntries(String baseDN, Class<T> entryClass, Filter filter) {\n+    if (StringHelper.isEmptyString(baseDN)) {\n+        throw new MappingException(\"Base DN to find entries is null\");\n+    }\n \n-        // Find entries\n-        Filter searchFilter;\n-        if (objectClasses.length > 0) {\n-            searchFilter = addObjectClassFilter(filter, objectClasses);\n-        } else {\n-            searchFilter = filter;\n-        }\n+    // Check entry class\n+    checkEntryClass(entryClass, false);\n+    String[] objectClasses = getTypeObjectClasses(entryClass);\n+    String[] ldapReturnAttributes = new String[] {\"\"}; // Don't load attributes\n \n-        CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n+    // Find entries\n+    Filter searchFilter;\n+    if (objectClasses.length > 0) {\n+        searchFilter = addObjectClassFilter(filter, objectClasses);\n+    } else {\n+        searchFilter = filter;\n+    }\n \n-        try {\n-            LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n-            operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n-                    ldapReturnAttributes);\n-        } catch (Exception ex) {\n-            throw new EntryPersistenceException(\n-                    String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n-        }\n+    CountBatchOperation<T> batchOperation = new CountBatchOperation<T>();\n \n-        return batchOperation.getCountEntries();\n+    try {\n+        LdapBatchOperationWraper<T> batchOperationWraper = new LdapBatchOperationWraper<T>(batchOperation);\n+        operationService.search(baseDN, toLdapFilter(searchFilter), toLdapSearchScope(SearchScope.SUB), batchOperationWraper, 0, 100, 0, null,\n+                ldapReturnAttributes);\n+    } catch (Exception ex) {\n+        throw new EntryPersistenceException(\n+                String.format(\"Failed to calucalte count of entries with baseDN: %s, filter: %s\", baseDN, searchFilter), ex);\n     }\n \n-    @Override\n-    public String encodeTime(Date date) {\n-        if (date == null) {\n-            return null;\n-        }\n+    return batchOperation.getCountEntries();\n+}\n \n-        return StaticUtils.encodeGeneralizedTime(date);\n+@Override\n+public String encodeTime(Date date) {\n+    if (date == null) {\n+        return null;\n     }\n \n-    public Date decodeTime(String date) {\n-        if (date == null) {\n-            return null;\n-        }\n-\n-        try {\n-            return StaticUtils.decodeGeneralizedTime(date);\n-        } catch (ParseException ex) {\n-            LOG.error(\"Failed to parse generalized time {}\", date, ex);\n-        }\n+    return StaticUtils.encodeGeneralizedTime(date);\n+}\n \n+public Date decodeTime(String date) {\n+    if (date == null) {\n         return null;\n     }\n \n-    public boolean loadLdifFileContent(String ldifFileContent) {\n-        LDAPConnection connection = null;\n-        try {\n-            connection = operationService.getConnection();\n-            ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n-            return ResultCode.SUCCESS.equals(result);\n-        } catch (Exception ex) {\n-            LOG.error(\"Failed to load ldif file\", ex);\n-            return false;\n-        } finally {\n-            if (connection != null) {\n-                operationService.releaseConnection(connection);\n-            }\n-        }\n+    try {\n+        return StaticUtils.decodeGeneralizedTime(date);\n+    } catch (ParseException ex) {\n+        LOG.error(\"Failed to parse generalized time {}\", date, ex);\n     }\n \n-    @Override\n-    public String[] exportEntry(String dn) {\n-        String[] ldif = null;\n-        try {\n-            ldif = this.operationService.lookup(dn).toLDIF();\n-        } catch (ConnectionException e) {\n-            LOG.error(\"Failed get ldif from \" + dn, e);\n-        }\n+    return null;\n+}\n \n-        return ldif;\n+public boolean loadLdifFileContent(String ldifFileContent) {\n+    LDAPConnection connection = null;\n+    try {\n+        connection = operationService.getConnection();\n+        ResultCode result = LdifDataUtility.instance().importLdifFileContent(connection, ldifFileContent);\n+        return ResultCode.SUCCESS.equals(result);\n+    } catch (Exception ex) {\n+        LOG.error(\"Failed to load ldif file\", ex);\n+        return false;\n+    } finally {\n+        if (connection != null) {\n+            operationService.releaseConnection(connection);\n+        }\n     }\n+}\n \n-    public int getSupportedLDAPVersion() {\n-        return this.operationService.getSupportedLDAPVersion();\n+@Override\n+public String[] exportEntry(String dn) {\n+    String[] ldif = null;\n+    try {\n+        ldif = this.operationService.lookup(dn).toLDIF();\n+    } catch (ConnectionException e) {\n+        LOG.error(\"Failed get ldif from \" + dn, e);\n     }\n \n-    private Modification createModification(final ModificationType modificationType, final String attributeName, final String... attributeValues) {\n-        String realAttributeName = attributeName;\n-        if (operationService.isCertificateAttribute(realAttributeName)) {\n-            realAttributeName += \";binary\";\n-            byte[][] binaryValues = toBinaryValues(attributeValues);\n+    return ldif;\n+}\n \n-            return new Modification(modificationType, realAttributeName, binaryValues);\n-        }\n+public int getSupportedLDAPVersion() {\n+    return this.operationService.getSupportedLDAPVersion();\n+}\n \n-        return new Modification(modificationType, realAttributeName, attributeValues);\n-    }\n+private Modification createModification(final ModificationType modificationType, final String attributeName, final String... attributeValues) {\n+    String realAttributeName = attributeName;\n+    if (operationService.isCertificateAttribute(realAttributeName)) {\n+        realAttributeName += \";binary\";\n+        byte[][] binaryValues = toBinaryValues(attributeValues);\n \n-    private com.unboundid.ldap.sdk.Filter toLdapFilter(Filter genericFilter) throws SearchException {\n-        return LDAP_FILTER_CONVERTER.convertToLdapFilter(genericFilter);\n+        return new Modification(modificationType, realAttributeName, binaryValues);\n     }\n \n-    private com.unboundid.ldap.sdk.SearchScope toLdapSearchScope(SearchScope scope) throws SearchScopeException {\n-        return LDAP_SEARCH_SCOPE_CONVERTER.convertToLdapSearchScope(scope);\n-    }\n+    return new Modification(modificationType, realAttributeName, attributeValues);\n+}\n \n-    private static final class CountBatchOperation<T> extends DefaultBatchOperation<T> {\n+private com.unboundid.ldap.sdk.Filter toLdapFilter(Filter genericFilter) throws SearchException {\n+    return LDAP_FILTER_CONVERTER.convertToLdapFilter(genericFilter);\n+}\n \n-        private int countEntries = 0;\n+private com.unboundid.ldap.sdk.SearchScope toLdapSearchScope(SearchScope scope) throws SearchScopeException {\n+    return LDAP_SEARCH_SCOPE_CONVERTER.convertToLdapSearchScope(scope);\n+}\n \n-        @Override\n-        public void performAction(List<T> entries) {\n-        }\n+private static final class CountBatchOperation<T> extends DefaultBatchOperation<T> {\n \n-        @Override\n-        public boolean collectSearchResult(int size) {\n-            countEntries += size;\n-            return false;\n-        }\n+    private int countEntries = 0;\n \n-        public int getCountEntries() {\n-            return countEntries;\n-        }\n+    @Override\n+    public void performAction(List<T> entries) {\n+    }\n+\n+    @Override\n+    public boolean collectSearchResult(int size) {\n+        countEntries += size;\n+        return false;\n     }\n \n+    public int getCountEntries() {\n+        return countEntries;\n+    }\n+}\n+\n }\n",
            "diff_size": 393
        }
    ]
}